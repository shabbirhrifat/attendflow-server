// ==================== USER MODULE ====================
// Contains user-related models

// Main User model
model User {
    id           String     @id @default(cuid())
    email        String     @unique // REQUIRED: Email is mandatory for all users
    username     String?    @unique
    password     String
    name         String
    role         UserRole   @default(STUDENT)
    status       UserStatus @default(ACTIVE)
    avatar       String?
    phone        String?
    address      String?
    dateOfBirth  DateTime?
    departmentId String? // OPTIONAL: Can be assigned later
    createdAt    DateTime   @default(now())
    updatedAt    DateTime   @updatedAt

    // Student-specific relationships
    studentProfile Student?
    // Teacher-specific relationships
    teacherProfile Teacher?
    department     Department?     @relation("DepartmentUsers", fields: [departmentId], references: [id])
    classSchedules ClassSchedule[] @relation("TeacherSchedules")

    // Course relationships
    taughtCourses     Course[]           @relation("TeacherCourses")
    courseEnrollments CourseEnrollment[]

    // Attendance relationships
    attendanceRecords Attendance[]        @relation("UserAttendance")
    markedAttendances Attendance[]        @relation("AttendanceMarker")
    teacherSessions   AttendanceSession[] @relation("TeacherSessions")

    // Leave relationships
    leaveRequests         LeaveRequest[] @relation("UserLeaveRequests")
    approvedLeaveRequests LeaveRequest[] @relation("ApprovedLeaveRequests")
    leaveBalance          LeaveBalance?  @relation("UserLeaveBalance")

    // Other relationships
    notifications           Notification[]
    refreshTokens           RefreshToken[]
    passwordResetTokens     PasswordResetToken[]
    emailVerificationTokens EmailVerificationToken[]
    sessions                Session[]         @relation("UserSessions")

    @@index([role])
    @@index([status])
    @@index([departmentId])
    @@index([createdAt])
    @@map("users")
}

// Student profile model
model Student {
    id             String   @id @default(cuid())
    userId         String   @unique
    studentId      String   @unique // AUTO-GENERATED: Should not be in create forms
    batchId        String? // OPTIONAL: Can be assigned later via assignment API
    departmentId   String? // OPTIONAL: Can be assigned later via assignment API
    semester       Int      @default(1)
    enrollmentDate DateTime @default(now())
    gpa            Float?   @default(0.0)
    credits        Int      @default(0)
    isActive       Boolean  @default(true)
    createdAt      DateTime @default(now())
    updatedAt      DateTime @updatedAt

    // Relationships
    user              User           @relation(fields: [userId], references: [id], onDelete: Cascade)
    batch             Batch?         @relation(fields: [batchId], references: [id])
    department        Department?    @relation(fields: [departmentId], references: [id])
    attendanceRecords Attendance[]   @relation("StudentAttendance")
    leaveRequests     LeaveRequest[] @relation("StudentLeaveRequests")
    leaveBalance      LeaveBalance?  @relation("StudentLeaveBalance")

    @@index([batchId])
    @@index([departmentId])
    @@index([isActive])
    @@index([studentId])
    @@map("students")
}

// Teacher profile model
model Teacher {
    id             String   @id @default(cuid())
    userId         String   @unique
    employeeId     String   @unique // AUTO-GENERATED: Should not be in create forms
    departmentId   String? // OPTIONAL: Can be assigned later via assignment API
    designation    String?
    specialization String?
    joinDate       DateTime @default(now())
    isActive       Boolean  @default(true)
    createdAt      DateTime @default(now())
    updatedAt      DateTime @updatedAt

    // Relationships
    user              User           @relation(fields: [userId], references: [id], onDelete: Cascade)
    department        Department?    @relation(fields: [departmentId], references: [id])
    courses           Course[]       @relation("TeacherProfileCourses")
    leaveRequests     LeaveRequest[] @relation("TeacherLeaveRequests")
    leaveBalance      LeaveBalance?  @relation("TeacherLeaveBalance")
    headedDepartments Department[]   @relation("DepartmentHead")

    @@index([departmentId])
    @@index([isActive])
    @@index([employeeId])
    @@map("teachers")
}
