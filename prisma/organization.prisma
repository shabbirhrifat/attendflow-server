// ==================== ORGANIZATION MODULE ====================
// Contains models for organizational structure

// Batch model
model Batch {
    id          String   @id @default(cuid())
    name        String   @unique
    year        Int
    description String?
    startDate   DateTime
    endDate     DateTime
    isActive    Boolean  @default(true)
    createdAt   DateTime @default(now())
    updatedAt   DateTime @updatedAt

    // Relationships
    students  Student[]
    courses   Course[]
    schedules ClassSchedule[]

    @@index([year])
    @@index([isActive])
    @@map("batches")
}

// Department model
model Department {
    id          String   @id @default(cuid())
    name        String   @unique
    code        String   @unique
    description String?
    headId      String? // OPTIONAL: Department can exist without head, head can be assigned later
    isActive    Boolean  @default(true)
    createdAt   DateTime @default(now())
    updatedAt   DateTime @updatedAt

    // Relationships
    students  Student[]
    courses   Course[]
    teachers  Teacher[]
    users     User[]     @relation("DepartmentUsers")
    subjects  Subject[]
    semesters Semester[]
    head      Teacher?   @relation("DepartmentHead", fields: [headId], references: [id])

    @@index([isActive])
    @@map("departments")
}

// Semester model
model Semester {
    id           String   @id @default(cuid())
    name         String
    year         Int
    departmentId String
    startDate    DateTime
    endDate      DateTime
    isActive     Boolean  @default(true)
    createdAt    DateTime @default(now())
    updatedAt    DateTime @updatedAt

    // Relationships
    department Department @relation(fields: [departmentId], references: [id])
    courses    Course[]   @relation("CourseSemester")

    @@unique([departmentId, year, name])
    @@map("semesters")
}

// Subject model
model Subject {
    id           String   @id @default(cuid())
    name         String   @unique
    code         String   @unique
    description  String?
    credits      Int      @default(0)
    departmentId String
    isActive     Boolean  @default(true)
    createdAt    DateTime @default(now())
    updatedAt    DateTime @updatedAt

    // Relationships
    department Department @relation(fields: [departmentId], references: [id])
    courses    Course[]

    @@map("subjects")
}

// Course model
model Course {
    id           String   @id @default(cuid())
    title        String
    code         String   @unique
    description  String?
    credits      Int      @default(0)
    batchId      String? // OPTIONAL: Can be assigned later via assignment API
    departmentId String? // OPTIONAL: Can be assigned later via assignment API
    teacherId    String? // OPTIONAL: Can be assigned later via assignment API
    subjectId    String? // OPTIONAL: Can be assigned later
    semesterId   String? // OPTIONAL: Can be assigned later
    semester     Int      @default(1)
    isActive     Boolean  @default(true)
    createdAt    DateTime @default(now())
    updatedAt    DateTime @updatedAt

    // Relationships
    teacher            User?               @relation("TeacherCourses", fields: [teacherId], references: [id], map: "course_teacher_fkey")
    teacherProfile     Teacher?            @relation("TeacherProfileCourses", fields: [teacherId], references: [id], map: "course_teacher_profile_fkey")
    batch              Batch?              @relation(fields: [batchId], references: [id])
    department         Department?         @relation(fields: [departmentId], references: [id])
    subject            Subject?            @relation(fields: [subjectId], references: [id])
    semesterInfo       Semester?           @relation("CourseSemester", fields: [semesterId], references: [id])
    enrollments        CourseEnrollment[]
    attendanceRecords  Attendance[]        @relation("CourseAttendance")
    schedules          ClassSchedule[]
    attendanceSessions AttendanceSession[] @relation("CourseSessions")

    @@index([departmentId])
    @@index([teacherId])
    @@index([batchId])
    @@index([semesterId])
    @@index([isActive])
    @@index([code])
    @@map("courses")
}

// Course enrollment model
model CourseEnrollment {
    id         String   @id @default(cuid())
    studentId  String
    courseId   String
    enrolledAt DateTime @default(now())

    // Relationships
    student User   @relation(fields: [studentId], references: [id])
    course  Course @relation(fields: [courseId], references: [id])

    @@unique([studentId, courseId])
    @@map("course_enrollments")
}

// Class schedule model
model ClassSchedule {
    id        String   @id @default(cuid())
    teacherId String? // OPTIONAL: Can be assigned later via assignment API
    courseId  String? // OPTIONAL: Can be assigned later via assignment API
    batchId   String? // OPTIONAL: Can be assigned later via assignment API
    dayOfWeek Int
    startTime String
    endTime   String
    room      String?
    semester  Int      @default(1)
    isActive  Boolean  @default(true)
    createdAt DateTime @default(now())
    updatedAt DateTime @updatedAt

    // Relationships
    teacher User?   @relation("TeacherSchedules", fields: [teacherId], references: [id])
    course  Course? @relation(fields: [courseId], references: [id])
    batch   Batch?  @relation(fields: [batchId], references: [id])

    @@map("class_schedules")
}

// Settings model
model Setting {
    id        String   @id @default(cuid())
    key       String   @unique
    value     String
    group     String   @default("GENERAL")
    createdAt DateTime @default(now())
    updatedAt DateTime @updatedAt

    @@map("settings")
}
