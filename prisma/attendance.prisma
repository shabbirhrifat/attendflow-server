// ==================== ATTENDANCE MODULE ====================
// Contains attendance-related models

// Attendance model
model Attendance {
    id                  String           @id @default(cuid())
    userId              String
    courseId            String
    date                DateTime
    status              AttendanceStatus
    checkIn             DateTime?
    checkOut            DateTime?
    notes               String?
    markedBy            String?
    createdAt           DateTime         @default(now())
    updatedAt           DateTime         @updatedAt
    attendanceSessionId String?

    // Relationships
    user              User               @relation("UserAttendance", fields: [userId], references: [id], map: "attendance_user_fkey")
    course            Course             @relation("CourseAttendance", fields: [courseId], references: [id])
    marker            User?              @relation("AttendanceMarker", fields: [markedBy], references: [id])
    student           Student            @relation("StudentAttendance", fields: [userId], references: [id], map: "attendance_student_fkey")
    attendanceSession AttendanceSession? @relation("SessionAttendances", fields: [attendanceSessionId], references: [id])

    @@unique([userId, courseId, date])
    @@index([userId, date])
    @@index([courseId])
    @@index([date])
    @@index([status])
    @@index([markedBy])
    @@index([attendanceSessionId])
    @@map("attendances")
}

// Attendance Session model
model AttendanceSession {
    id        String    @id @default(cuid())
    courseId  String
    teacherId String
    date      DateTime
    startTime DateTime
    endTime   DateTime?
    isActive  Boolean   @default(true)
    location  String?
    notes     String?
    createdAt DateTime  @default(now())
    updatedAt DateTime  @updatedAt

    // Relationships
    course      Course       @relation("CourseSessions", fields: [courseId], references: [id])
    teacher     User         @relation("TeacherSessions", fields: [teacherId], references: [id])
    attendances Attendance[] @relation("SessionAttendances")

    @@index([courseId])
    @@index([teacherId])
    @@index([date])
    @@index([isActive])
    @@map("attendance_sessions")
}
